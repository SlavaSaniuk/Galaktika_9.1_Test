.begin
  var lnSName    // Длина поля "Наименование товара"
    , lnSCode    // Длина "Бар кода МЦ"
    , lnSPrim    // Длина поля "Примечание"
    : byte;

  var sName      // Поле "Наименование"
    , sName2     // Поле "Наименование". Доп.информация МЦ
    , sCode      // Поле "Наименование". Бпр код МЦ
    : string;

  var piExClass  // Объект для работы с внешними атрибутами
    : iExtClass;

  var _ClassCode // Код внешней классификации
    , KolLine    // Число строк в спецификации
    : word;

  var KolTMP     // Временная
    , i          // Счетчик
    , Options    // Разделитель страницы
    , MainKol    // Число строк на первой странице
    : word;

  var isKolSave  // Есть ли недопечатанные МЦ
    : boolean;

  var KolInSpSopr
    : word;

#ifdef _TTN_FRN_
  #ifdef _TTN_2009F_
    lnSName   := 35;
    lnSPrim   := 29;

  #ifdef _TTN_2009P_
    lnSName   := 26;
    lnSPrim   := 18;
    lnSCode   := 0;
  #else
    lnSCode   := 0;
  #end

  #ifdef _TTN_2009R_
    lnSName   := 19;
    lnSCode   := 0;
  #end

    ReadMyDSK(MainKol, 'MainKolTTN2009', false);
    ReadMyDSK(FixKol , 'FixKolTTN2009' , false);
    ReadMyDSK(Options, 'OptionsTTN2009', false);
  #else
    lnSName     := 47;
    lnSCode     := 0;
    lnSPrim     := 39;
    ReadMyDSK(MainKol, 'MainKolTTN', false);
    ReadMyDSK(FixKol , 'FixKolTTN' , false);
    ReadMyDSK(Options, 'OptionsTTN', false);
  #end
#end

#ifdef _TN2_PC_FRN_
  #ifdef _TTN_2009F_
    lnSName    := 24;
    lnSPrim    := 26;
    lnSCode    := 0;
  #else
    lnSName    := 32;
    lnSPrim    := 25;
    lnSCode    := 0;
  #end
    ReadMyDSK(MainKol, 'MainKolTN2', false);
    ReadMyDSK(FixKol , 'FixKolTN2' , false);
    ReadMyDSK(Options, 'OptionsTN2', false);
#end

  if (Options = 1)
    СпецСимвол := '';

  KolSpSopr.pNrec := накладная_нрек;

  KolTMP := 0;
  i      := 0; //номер страницы
  KolInSpSopr := количество_SpSopr;

  var isExistsClass: boolean;

  #ifdef _TTN_DOC_ROZN_
    PRN_DOPINFO.wTable := coRzSpDoc;
  #else
    PRN_DOPINFO.wTable := coSpSopr;
  #end
  isExistsClass := (PRN_DOPINFO.GetFirst ExClassName = tsOk);

  // подсчет кол-ва строк в печатной форме
  KolSpSopr._LOOP SpSoprMemTTN
  {
    KolLine := 0;
    sName   := '';

    if (isExistsClass)
    {
      #ifdef _TTN_DOC_ROZN_
        PRN_DOPINFO.pNRec := KolSpSopr.SpSoprMemTTN.cOwner;
      #else
        PRN_DOPINFO.pNRec := KolSpSopr.SpSoprMemTTN.NRec;
      #end

      PRN_DOPINFO._Loop ExClassVal
        if (PRN_DOPINFO.GetFirst ExClassSeg = tsOk)
          sName := sName + if (sName = '', '', '; ') + PRN_DOPINFO.ExClassSeg.Name;

      if (sName = '')
      {
        PRN_DOPINFO.pNRec := KolSpSopr.KatParty.NRec;

        PRN_DOPINFO._Loop ExClassVal
          if (PRN_DOPINFO.GetFirst ExClassSeg = tsOk)
            sName := sName + if (sName = '', '', '; ') + PRN_DOPINFO.ExClassSeg.Name;
      }

      if (sName = '')
      {
        PRN_DOPINFO.pNRec := KolSpSopr.KatMC.NRec;

        PRN_DOPINFO._Loop ExClassVal
          if (PRN_DOPINFO.GetFirst ExClassSeg = tsOk)
            sName += '; ' + PRN_DOPINFO.ExClassSeg.Name;
      }
    }

   #ifdef _TTN_ALC_
    _ClassCode := piExClass.GetClassCode (coSpSopr, 'СТРАНА ВВОЗА');
    sName2     := piExClass.GetSegName (_ClassCode, KolSpSopr.SpSoprMemTTN.NRec);

    if (sName2 = '')
    {
      _ClassCode := piExClass.GetClassCode (coKatParty, 'СТРАНА ВВОЗА');
      sName2     := piExClass.GetSegName (_ClassCode  , KolSpSopr.KatParty.NRec);
    }
   #end

    if (isTTN_Fast)
    {
      MCDopInfo [KolSpSopr.SpSoprMemTTN.Npp] := sName;
      MCStrana  [KolSpSopr.SpSoprMemTTN.Npp] := sName2;
    }

    sName :=   KolSpSopr.KatMc.Name
             + if (bBarKodMC, if (KolSpSopr.KatMc.BarKod <> '', ' ' + KolSpSopr.KatMc.BarKod, ''), '')
             + if(sName  <> '', ' ('  + sName + ')', '')
             + if(sName2 <> '', ' ; ' + sName2     , '');

    sCode := KolSpSopr.KatMc.BarKod;

    KolTMP++;//на какой строке на листе нахожусь

    isKolSave := false;

    if (length(sName) > lnSName) or (length(sCode) > lnSCode)
    {
      if wGetTune('Doc.SD.PrnNakl.TTNFormatMC') = 1
        KolLine := GetKolStr (sName, lnSName);//кол. доп. строк
      else
        KolLine := KolAddInStr (sName, lnSName, true);//кол. доп. строк c форматированием

      var tKolLine: word;
      tKolLine := KolAddInStr (sCode, lnSCode, false);

      if (tKolLine > KolLine)
        KolLine := tKolLine;

      KolInSpSopr += KolLine; //общее к-во строк в спецификации

      KolTMP += KolLine;

      if (KolTMP > FixKol) //количество строк на i-ом листе
      {
        i++;

        #ifdef _TTN_FRN_
          #ifdef _TTN_2009F_
            SaveMyDsk(word(KolTMP - KolLine - 1), 'KolLineInTTN2009' + string(i));
          #else
            SaveMyDsk(word(KolTMP - KolLine - 1), 'KolLineInTTN'     + string(i));
          #end
        #end

        #ifdef _TN2_PC_FRN_
            SaveMyDsk(word(KolTMP - KolLine - 1), 'KolLineInTN2'     + string(i));
        #end

        KolTMP := KolLine + 1;//недопечатанное наим. МЦ

        isKolSave := true;
      }
    }

    if (KolTMP = FixKol) and (not isKolSave)  //количество строк на i-ом листе
    {
      i++;

      #ifdef _TTN_FRN_
        #ifdef _TTN_2009F_
          SaveMyDsk(word(FixKol), 'KolLineInTTN2009' + string(i));
        #else
          SaveMyDsk(word(FixKol), 'KolLineInTTN'     + string(i));
        #end
      #end

      #ifdef _TN2_PC_FRN_
          SaveMyDsk(word(FixKol), 'KolLineInTN2'     + string(i));
      #end

      KolTMP := 0;
    }
  }//_LOOP

  if (KolTmp > 0) //если есть недопечатанное название МЦ
  {
    i++;  //количество строк на последнем листе

    #ifdef _TTN_FRN_
      #ifdef _TTN_2009F_
        SaveMyDsk(word(FixKol), 'KolLineInTTN2009' + string(i));
      #else
        SaveMyDsk(word(FixKol), 'KolLineInTTN'     + string(i));
      #end
    #end

    #ifdef _TN2_PC_FRN_
        SaveMyDsk(word(FixKol), 'KolLineInTN2'     + string(i));
    #end
  }

#ifdef _TTN_FRN_
  if (KolInSpSopr > MainKol)
    CheckKol := true;//количество строк на первом листе
#end

#ifdef _TN2_PC_FRN_
  if (KolInSpSopr > MainKol)
    CheckKol := true;//количество строк на первом листе
#end

  DopOtpRaz := boGetTune('DOC.SD.PRNNAKL.OTPRAZTTN');

end.
